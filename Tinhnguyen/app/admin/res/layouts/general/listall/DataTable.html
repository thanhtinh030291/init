<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-{$table['icon']}"></i>
                {$table["plural`$smarty.session.lzalanguage`"]}
                <div class="pull-right">
                    <div class="btn-group">
                        {if (!isset($options->add) || $options->add) &&
                            ($permission & ADD_LEVEL) === ADD_LEVEL}
                            <button title="{$res->i18n->addNewItem(
                                        $table["single`$smarty.session.lzalanguage`"]
                                    )}"
                                    type="button" class="btn btn-default btn-sm list-button group-buttons"
                                    onClick="window.open(
                                        '{$regionPath}/{chain_case($res->env->module)}/add'
                                    );">
                                <i class="fa fa-plus"></i>
                            </button>
                        {/if}
                        {if (!isset($options->edit) || $options->edit) &&
                            ($permission & EDIT_LEVEL) === EDIT_LEVEL}
                            <button title="{$res->i18n->editAllSelectedItems(
                                        $table["plural`$smarty.session.lzalanguage`"]
                                    )}"
                                    type="button" class="btn btn-default btn-sm list-button group-buttons"
                                    data-toggle="modal"
                                    data-target="#edit-modal">
                                <i class="fa fa-pencil"></i>
                            </button>
                        {/if}
                        {if (!isset($options->delete) || $options->delete) &&
                            ($permission & EDIT_LEVEL) === EDIT_LEVEL}
                            <button title="{$res->i18n->deleteAllSelectedItems(
                                        $table["plural`$smarty.session.lzalanguage`"]
                                    )}"
                                    type="button"
                                    class="btn btn-default btn-sm list-button group-buttons"
                                    data-toggle="modal"
                                    data-target="#delete-modal">
                                <i class="fa fa-trash"></i>
                            </button>
                        {/if}
                        <button title="{$res->i18n->advanced}"
                                aria-expanded="true"
                                type="button"
                                style="padding: 5px 15px 5px 15px;"
                                class="btn btn-default btn-sm list-button dropdown-toggle group-buttons"
                                data-toggle="dropdown">
                            <i class="fa fa-navicon"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu">
                            <li>
                                <a data-toggle="modal" data-target="#add-filter-modal">
                                    <i class="fa fa-plus"></i>
                                    {$res->i18n->addFilter}
                                </a>
                            </li>
                            {if count($filters) > 0}
                             <li>
                                 <a data-toggle="modal" data-target="#manage-filter-modal">
                                     <i class="fa fa-filter"></i>
                                     {$res->i18n->manageFilter}
                                 </a>
                             </li>
                            {/if}
                            {if (!isset($options->add) || $options->add) &&
                                ($permission & ADD_LEVEL) === ADD_LEVEL}
                                <li class="divider"></li>
                                <li>
                                    <a data-toggle="modal" data-target="#import-modal">
                                        <i class="fa fa-download"></i>
                                        {$res->i18n->import($table["plural`$smarty.session.lzalanguage`"])}
                                    </a>
                                </li>
                            {/if}
                            <li class="divider"></li>
                            <li>
                                <a data-toggle="modal" data-target="#export-modal">
                                    <i class="fa fa-upload"></i>
                                    {$res->i18n->export($table["plural`$smarty.session.lzalanguage`"])}
                                </a>
                            </li>
                            <li>
                                <a data-toggle="modal" data-target="#export-all-modal">
                                    <i class="fa fa-upload"></i>
                                    {$res->i18n->exportAll($table["plural`$smarty.session.lzalanguage`"])}
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div class="dataTable_wrapper">
                    <table class="table table-striped table-bordered table-hover responsive"
                           style="text-align: center;"
                           id="data-table">
                        <thead>
                            <tr>
                                {assign var=refTable value=''}
                                {assign var=refModule value=array()}
                                <th style="text-align: center"></th>
                                    {foreach $fields as $field}
                                        <th style="text-align: center">
                                            {$field["single`$smarty.session.lzalanguage`"]}
                                        </th>
                                        {if $field['type'] === 'self'}
                                            {$refTable = $field['table']}
                                            {assign var=refItems value=$database->$refTable()}
                                        {/if}
                                    {/foreach}
                                    <!--<th style="text-align: center">Version</th>-->
                                    {if SHOW_LAST_MODIFIED}
                                        <th style="text-align: center">
                                            {$res->i18n->lastModified}
                                        </th>
                                    {/if}
                                <th style="text-align: center">
                                    {$res->i18n->action}
                                </th>
                            </tr>
                        </thead>
                        <tfoot style="display: table-header-group;">
                            <tr>
                                {assign var=refTable value=''}
                                {assign var=refModule value=array()}
                                <th style="text-align: center; vertical-align: inherit;">
                                    <i class="fa fa-filter"></i>
                                </th>
                                    {foreach $fields as $field}
                                        <th style="text-align: center">
                                            {include file="general/listall/field/search/{$field['type']}.html"}
                                        </th>
                                    {/foreach}
                                    <!--<th style="text-align: center"><b>Version</b></th>-->
                                    {if SHOW_LAST_MODIFIED}
                                        <td style="text-align: center"></td>
                                    {/if}
                                <th style="text-align: center; vertical-align: inherit;">
                                    <i class="fa fa-filter"></i>
                                </th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
var table = null;
$(document).ready(function()
{
    table = $('#data-table').DataTable(
    {
        columnDefs:
        [
            {
                targets: 0,
                orderable: false,
                checkboxes: {
                    selectRow: true
                }
            },
            {
                targets: -1,
                orderable: false
            }
        ],
        order: [
            {$table['sort']}
        ],
        select: {
            style: 'multi'
        },
        lengthMenu: [
            25, 50, 100, 250, 500
        ],
        displayLength: 50,
        responsive: true,
        autoWidth: false,
        processing: true,
        serverSide: true,
        ajax:
        {
            url: "{WEBSITE_URL}/showall?{$smarty.session.token_name}_token={$smarty.session.token_value}",
            type: "POST"
        },
        language:
        {
            emptyTable: "{$res->i18n->emptyTable}",
            lengthMenu: "{$res->i18n->lengthMenu}",
            zeroRecords: "{$res->i18n->zeroRecords}",
            info: "{$res->i18n->info}",
            infoEmpty: "{$res->i18n->infoEmpty}",
            infoFiltered: "{$res->i18n->infoFiltered}",
            search: "{$res->i18n->search}",
            loadingRecords: "{$res->i18n->loadingRecords}...",
            processing: "{$res->i18n->processing}...",
            paginate:
            {
                first: "{$res->i18n->first}",
                last: "{$res->i18n->last}",
                previous: "{$res->i18n->previous}",
                next: "{$res->i18n->next}"
            },
            aria:
            {
                sortAscending: "{$res->i18n->sortAscending}",
                sortDescending: "{$res->i18n->sortDescending}"
            }
        }
    });
    table.columns().every(function()
    {
        var that = this;
        $('select', this.footer()).on('keyup change', function()
        {
            if (that.search() !== $("#" + this.id).select2('val'))
            {
                that.search($("#" + this.id).select2('val')).draw();
            }
        });
        $('input[type=text]', this.footer()).on('keyup change', function()
        {
            if (that.search() !== this.value)
            {
                that.search(this.value).draw();
            }
        });
    });
    $('form').on('submit', function(e)
    {
        var form = this;
        var selectedRows = table.column(0).checkboxes.selected();
        $.each(selectedRows, function(index, rowId)
        {
            $(form).append($('<input>').attr('type', 'hidden').attr('name', 'rows[]').val(rowId));
        });
    });
    $('select[name=data-table_length]').select2(
    {
        containerCssClass: ":all"
    });
});
</script>
